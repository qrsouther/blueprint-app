#!/usr/bin/env node

/**
 * Generate Build Timestamp Script
 * 
 * This script generates a build timestamp and writes it to src/utils/version.js
 * It should be run before building/deploying the app.
 */

const fs = require('fs');
const path = require('path');

// Generate ISO timestamp
const buildTimestamp = new Date().toISOString();

// Format for display (e.g., "2024-01-15 14:30:45 UTC")
const buildDate = new Date();
const formattedDate = buildDate.toISOString().replace('T', ' ').substring(0, 19) + ' UTC';

// Content to write to version.js
const versionFileContent = `/**
 * Build Timestamp
 * 
 * This file is automatically generated at build time by scripts/generate-build-timestamp.js
 * DO NOT manually edit this file - it will be overwritten on each build.
 */

export const BUILD_TIMESTAMP = '${buildTimestamp}';
export const BUILD_TIMESTAMP_FORMATTED = '${formattedDate}';
`;

// Path to version.js
const versionFilePath = path.join(__dirname, '..', 'src', 'utils', 'version.js');

// Write the file
try {
  fs.writeFileSync(versionFilePath, versionFileContent, 'utf8');
  console.log(`✓ Build timestamp generated: ${formattedDate}`);
  console.log(`✓ Updated ${versionFilePath}`);
  console.log(`✓ Timestamp: ${buildTimestamp}`);
  
  // Verify the file was written correctly
  const writtenContent = fs.readFileSync(versionFilePath, 'utf8');
  if (!writtenContent.includes(buildTimestamp)) {
    throw new Error('Timestamp verification failed - file content does not match expected timestamp');
  }
  console.log(`✓ Verification passed`);
} catch (error) {
  console.error('✗ Error generating build timestamp:', error);
  process.exit(1);
}

